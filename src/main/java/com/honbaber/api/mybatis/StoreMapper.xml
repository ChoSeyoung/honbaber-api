<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.honbaber.api.mapper.StoreMapper">
	<select id="getStore" parameterType="hashmap" resultType="hashmap"> 
		select name,
		       tel,
		       post,
		       addr1,
		       addr2,
		       total_rate,
		       total_rate_cnt
		from store join store_detail on store.id = store_detail.store_id 
		<![CDATA[
		where (
			6371 * acos (
			cos ( radians(#{lat}) )
			* cos( radians( store.lat ) )
			* cos( radians( store.lng ) - radians(#{lng}) )
			+ sin ( radians(#{lat}) )
			* sin( radians( store.lat ) )
		)) < #{radius} 
		and store_detail.total_rate >= #{rate} 
		and store.signature_menu like '%'||#{keyword}||'%'
		]]> 
	</select>
	<select id="getStoreDetail" parameterType="integer" resultType="hashmap"> 
		select name,
		       tel,
		       post,
		       addr1,
		       addr2,
		       total_rate,
		       total_rate_cnt,
		       sense_rate,
		       sense_rate_cnt,
		       time_rate,
		       time_rate_cnt,
		       taste_rate,
		       taste_rate_cnt,
		       website,
		       open_day,
		       open_at,
		       off_day
		from store join store_detail on store.id = store_detail.store_id
		where store.id = #{id}  
	</select>
</mapper>

